---js
// Eleventy 3.0 JavaScript Front Matter  
// 导出导航配置
const eleventyNavigation = {
  key: "Homepage",
  order: 1
};

// 导出每次加载数
const numberOfLatestPostsToShow = 9;
---
{% set posts = collections.posts %}
{% set total = posts | length %}
{% set showCount = [ total, numberOfLatestPostsToShow ] | min %}

<h1>
  Latest {{ showCount }} Post{% if showCount != 1 %}s{% endif %}
</h1>

<div id="posts-container">
  {% for post in posts | reverse %}
    <article
      class="post-item"
      data-index="{{ loop.index0 }}"
      style="display: {% if loop.index0 < showCount %}block{% else %}none{% endif %}; margin-bottom:2rem;"
    >
      <h2><a href="{{ post.url }}">{{ post.data.title }}</a></h2>
      {% if post.data.description %}
        <p>{{ post.data.description }}</p>
      {% endif %}
    </article>
  {% endfor %}
</div>

<div id="scroll-sentinel" style="width:100%; height:1px;"></div>

<script>
  // 此处 numberOfLatestPostsToShow 已正确注入
  window.numberOfLatestPostsToShow = {{ numberOfLatestPostsToShow }};

  (function() {
    const posts    = document.querySelectorAll('.post-item');
    let   loaded   = window.numberOfLatestPostsToShow;
    const sentinel = document.getElementById('scroll-sentinel');

    const observer = new IntersectionObserver((entries, obs) => {
      entries.forEach(entry => {
		// 调试：打印是否进入视口
        console.log('Sentinel isIntersecting:', entry.isIntersecting);
        if (entry.isIntersecting) {
          const next = loaded + window.numberOfLatestPostsToShow;
          for (let i = loaded; i < next && i < posts.length; i++) {
            posts[i].style.display = 'block';
          }
          loaded = next;
		  console.log('All posts loaded, disconnecting observer.');
          if (loaded >= posts.length) obs.disconnect();
        }
      });
    }, {
      root: null,
      rootMargin: '0px',
      threshold: 1.0
    });

    observer.observe(sentinel);
  })();
</script>
